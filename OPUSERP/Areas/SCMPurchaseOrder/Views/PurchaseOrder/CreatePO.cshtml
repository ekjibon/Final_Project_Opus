@model PurchaseOrderViewModel
@{
    ViewData["Title"] = "Purchase Order";
}

@section Style{
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote-bs4.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
}



        <div class="card mb-2">
            <form asp-area="SCMPurchaseOrder" asp-controller="PurchaseOrder" asp-action="Index" method="post" enctype="multipart/form-data" data-parsley-validate="parsley">
                <div asp-validation-summary="All" class="text-danger"></div>
                <input type="hidden" name="PurchaseOrderId" value="0" />
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header" style="padding:6px 0px 5px 3px;">
                            <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; Process Purchase Order</label>
                            <a class="col-sm-1 btn btn-sm btn-info" href="~/SCMPurchaseOrder/PurchaseOrder/Index" style="padding-left:0px;padding-right:0px;">Back To List</a>
                            
                        </div>
                        <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                            <table class="table table-striped table-bordered" id="csListTable">
                                <thead>
                                    <tr>
                                        <th>CS No.</th>
                                        <th>CS Creation Date</th>
                                        <th>Subject</th>
                                        <th>PR No</th>
                                        <th>CS Approval Date</th>
                                        <th>Assign Date</th>
                                        <th>Action</th>
                                </thead>
                                <tbody>
                                    @foreach (var data in Model.cSMasters)
                                    {
                                        <tr>
                                            <td>@data.csNo</td>
                                            <td>@data.csDate?.ToString("dd-MMM-yyyy")</td>
                                            <td>@data.requisition.subject</td>
                                            <td>@data.requisition.reqNo</td>
                                            <td>@data.csDate?.ToString("dd-MMM-yyyy")</td>
                                            <td>@data.requisition.assignDate?.ToString("dd-MMM-yyyy")</td>
                                            <td>
                                                <a class="btn btn-info" onclick="SupplierView(@data.Id,'@data.requisition.reqDept','@data.rfqRefNo',@data.requisitionId)" href="javascript:void(0)"><i class='fa fa-info-circle'></i></a>
                                            </td>
                                        </tr>
                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <br />

                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header" style="padding:6px 0px 5px 3px;">
                            <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; Select Supplier for Process PO</label>
                        </div>
                        <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                            <table class="table table-striped table-bordered" id="Suppliertbl">
                                <thead>
                                    <tr>
                                        <th>Supplier Code</th>
                                        <th>Supplier Name</th>
                                        <th>Total Value</th>
                                        <th>Action</th>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <br />

                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header" style="padding:6px 0px 5px 3px;">
                            <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; PO Information</label>
                        </div>
                        <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                            <div class="container">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group row">
                                            <label for="poNo" class="col-sm-4 col-form-label">PO No</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="poNo" name="poNo" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="poDate" class="col-sm-4 col-form-label">PO Date</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="poDate" name="poDate" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="deliveryDate" class="col-sm-4 col-form-label">Delivery Date<span style="color:red">*</span></label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="deliveryDate" name="deliveryDate" required />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="deliveryType" class="col-sm-4 col-form-label">Delivery Type<span style="color:red">*</span></label>
                                            <div class="col-sm-8">
                                                <select class="form-control" id="deliveryType" name="deliveryType" required>
                                                    <option value="">Select</option>
                                                    @foreach (var data in Model.deliveryModes)
                                                    {
                                                        <option value="@data.Id">@data.deliveryModeName</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="paymentType" class="col-sm-4 col-form-label">Payment Type<span style="color:red">*</span></label>
                                            <div class="col-sm-8">
                                                <select class="form-control" id="paymentType" name="paymentType" required>
                                                    <option value="">Select</option>
                                                    @foreach (var data in Model.paymentModes)
                                                    {
                                                        <option value="@data.Id">@data.paymentModeName</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="paymentType" class="col-sm-4 col-form-label">Payment Term<span style="color:red">*</span></label>
                                            <div class="col-sm-8">
                                                <select class="form-control" id="paymentTerm" name="paymenTerm" required>
                                                    <option value="">Select</option>
                                                    @foreach (var data in Model.paymentTerms)
                                                    {
                                                        <option value="@data.Id">@data.paymentTermsName</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="remarks" class="col-sm-4 col-form-label">Remarks</label>
                                            <div class="col-sm-8">
                                                <textarea rows="5" class="form-control" id="remarks" name="remarks"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <div class="form-group row">
                                            <label for="department" class="col-sm-4 col-form-label">Department</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="department" name="department" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="supplier" class="col-sm-4 col-form-label">Supplier</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="supplier" name="supplier" readonly />
                                                <input type="hidden" id="txtSupplierId" name="txtSupplierId" />
                                                <input type="hidden" id="txtCsmasterId" name="txtCsmasterId" />
                                                <input type="hidden" id="txtRequsitionId" name="txtRequsitionId" />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="contactPerson" class="col-sm-4 col-form-label">Contact Person</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="contactPerson" name="contactPerson" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="contactNo" class="col-sm-4 col-form-label">Contact No</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="contactNo" name="contactNo" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="RFQRef" class="col-sm-4 col-form-label">RFQ Ref</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="RFQRef" name="RFQRef" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="LOARef" class="col-sm-4 col-form-label">LOA Ref</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="LOARef" name="LOARef" readonly />
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label for="billToLocation" class="col-sm-4 col-form-label">Bill To Location<span style="color:red">*</span></label>
                                            <div class="col-sm-8">
                                                <textarea rows="5" required class="form-control" id="billToLocation" name="billToLocation"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header" style="padding:6px 0px 5px 3px;">
                            <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; PO Details</label>
                        </div>
                        <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                            <table class="table table-striped table-bordered" id="poDetailsListTable">
                                <thead>
                                    <tr>
                                        <th>Item Code</th>
                                        <th>Item Name</th>
                                        <th>Item Spec</th>
                                        <th>UoM</th>
                                        <th>CS Qty</th>
                                        <th>Unordered Qty</th>
                                        <th>CS Unit Rate</th>
                                        <th>Action</th>
                                </thead>
                                <tbody>
                                    @*@foreach (var data in Model.requisitionMaster)
                            {
                                <tr>
                                    <td>@data.reqNo</td>
                                    <td>@data.reqDate</td>
                                    <td>@data.subject</td>
                                    <td>@data.reqType</td>
                                    <td>
                                        <a class="btn btn-success" href="/Requisition/RequisitionMaster/CreateRequisition/?Id=@data.Id"><i class="fa fa-edit"></i></a>
                                        <a class="btn btn-info" title="Print PR" target='_blank' href="/Report/ReportMaster/PurchaseRequisitionPdf/?reqId=@data.Id"><i class='fa fa-print'></i></a>

                                    </td>
                                </tr>
                            }*@

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <br />

                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header" style="padding:6px 0px 5px 3px;">
                            <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; PO Item Details</label>
                        </div>
                        <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                            <table class="table table-striped table-bordered" id="poDetailsItemListTable">
                                <thead>
                                    <tr>
                                        <th>Item Code</th>
                                        <th>Item Name</th>
                                        <th>Unordered Qty</th>
                                        <th>Ordered Qty</th>
                                        <th>Unit Rate</th>
                                        <th>Amt Excl VAT</th>
                                        <th>Total</th>
                                        <th>Action</th>
                                </thead>
                                <tbody>
                                    @*@foreach (var data in Model.requisitionMaster)
                            {
                                <tr>
                                    <td>@data.reqNo</td>
                                    <td>@data.reqDate</td>
                                    <td>@data.subject</td>
                                    <td>@data.reqType</td>
                                    <td>
                                        <a class="btn btn-success" href="/Requisition/RequisitionMaster/CreateRequisition/?Id=@data.Id"><i class="fa fa-edit"></i></a>
                                        <a class="btn btn-info" title="Print PR" target='_blank' href="/Report/ReportMaster/PurchaseRequisitionPdf/?reqId=@data.Id"><i class='fa fa-print'></i></a>

                                    </td>
                                </tr>
                            }*@
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th colspan="6" style="text-align:right;">Grand Total</th>
                                        <th colspan="2" id="grandTotal"></th>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                
                <br />

                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header" style="padding:6px 0px 5px 3px;">
                            <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; Save Information</label>
                        </div>
                        <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                            <div class="container">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group row">
                                            <label for="savingsAmount" class="col-sm-4 col-form-label">Savings Amount</label>
                                            <div class="col-sm-8">
                                                <input data-parsley-type="number" class="form-control" id="savingsAmount" name="savingsAmount" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <div class="form-group row">
                                            <label for="savingsPercent" class="col-sm-4 col-form-label">Savings(%)</label>
                                            <div class="col-sm-8">
                                                <input data-parsley-type="number" data-parsley-trigger="keyup" class="form-control" id="savingsPercent" max="100" name="savingsPercent" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group row">
                                            <div class="col-12">
                                                <label style="float:right;margin-left:20px;"><input type="radio" name="TermsAndCondition" value="1" /> Without GT&C</label>
                                                <label style="float:right;"><input type="radio" name="TermsAndCondition" value="0" /> With GT&C</label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="POTC" class="col-sm-2 col-form-label">PO Terms & Conditions</label>
                                            <div class="col-sm-10">
                                                <textarea id="summernote" name="content">
                            </textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <button type="submit" class="btn btn-success" style="float:right">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>



<div class="modal fade" id="ValidatModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="width:1040px;">
            <div class="modal-header">
                <label class="modal-title pull-left" id="myModalLabel" style="color:rgb(9, 7, 161);font-size:1em;">
                    Add PO Item Details
                </label>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <br />
            </div>
            <div class="modal-body">
                <form data-parsley-validate="parsley">
                    <div class="container">
                        <div class="row">
                            <div class="col-5 row">
                                <label class="col-sm-4 col-form-label">Item Code</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtcode" readonly="readonly" />
                                <input type="hidden" id="HiddenItemId" readonly="readonly" />
                                <input type="hidden" id="HiddencsDetailsId" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Item Name</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtname" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Unit Name</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtunit" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Spacification</label>
                                <input class="col-sm-8 form-control" type="text" id="txtSpec" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Description</label>
                                <textarea class="col-sm-8 form-control" style="margin-bottom: 8px;" id="txtDescription" rows="4"></textarea>

                                <label class="col-sm-4 col-form-label">Delivery Location*</label>
                                <select class="col-sm-8 form-control" style="margin-bottom: 8px;" onchange="OtherLocation()" id="txtLocation" readonly="readonly">
                                    <option value="">Select One</option>
                                    @foreach (var data in Model.deliveryLocations)
                                    {
                                        <option value="@data.Id">@data.locationName</option>
                                    }
                                </select>

                                <label class="col-sm-4 col-form-label txtOtherLocation">Other Location</label>
                                <textarea class="col-sm-8 form-control txtOtherLocation" style="margin-bottom: 8px;" id="txtOtherLocation" rows="4"></textarea>

                                <label class="col-sm-4 col-form-label">Procurement Category</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtProcurementCategory" readonly="readonly" />
                            </div>

                            <div class="col-1"></div>

                            <div class="col-5 row">

                                <label class="col-sm-4 col-form-label">PR QTY</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;text-align:right;" type="text" id="txtPRQty" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Unordered QTY</label>
                                <input class="col-sm-8 form-control" type="text" id="txtUnOrderedQty" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label">Ordered QTY</label>
                                <input class="col-sm-8 form-control numeric" type="text" id="txtOrderedQty" style="margin-bottom: 8px;text-align:right;" />
                                <div class="col-sm-12 row">

                                    <label class="col-sm-4 col-form-label">Currency</label>
                                    <select class="col-sm-4 form-control" onchange="addCurrencyRate()" id="currency" readonly="readonly" style="margin-bottom: 8px;margin-left:10px;">
                                        @foreach (var data in Model.currencies)
                                        {
                                            <option value="@data.Id">@data.currencyName</option>
                                        }
                                    </select>
                                    <input type="text" class="form-control col-sm-3" style="text-align:right;margin-left:15px;" id="currencyRate" />
                                </div>
                                <label class="col-sm-4 col-form-label">Unit Rate</label>
                                <input class="col-sm-8 form-control" type="text" id="txtUnitRate" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label">Amt. Excl. VAT</label>
                                <input class="col-sm-8 form-control" type="text" id="txtAmtExVat" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label AitrelatedClass">AIT(%)</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control AitrelatedClass" type="text" id="txtAit" />

                                <label class="col-sm-4 col-form-label AitrelatedClass">AIT Amount</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control AitrelatedClass" type="text" id="txtAitAmount" readonly="readonly" />

                                <label class="col-sm-4 col-form-label AitrelatedClass">Amt. Incl. VAT</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control AitrelatedClass" type="text" id="txtAitIncludeAmount" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">VAT(%)</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control" type="text" id="txtVat" />

                                <label class="col-sm-4 col-form-label">VAT Amount</label>
                                <input class="col-sm-8 form-control" type="text" id="txtVatAmount" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label">Total Amount</label>
                                <input class="col-sm-8 form-control" type="text" id="txtTotalAmount" readonly="readonly" style="margin-bottom: 8px;text-align:right" />
                            </div>
                            <div class="col-1">
                                <input value="1" type="radio" style="margin-top:100px;" checked id="btnRadio" name="includeAlt" class="form-control" /><span>Incl AIT</span>
                                <br />
                                <input value="2" type="radio" id="btnRadio" name="includeAlt" class="form-control" /><span>Excl AIT</span>
                            </div>
                        </div>
                    </div>
                </form>
                <button class="btn btn-lg btn-success" onclick="AddItemInfo()" style="float:right">Add</button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-arrow-left"></i> Back</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote-bs4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script type="text/javascript">
        var bdtUnitRate = 0;
        $(document).ready(function () {
            $('#csListTable').DataTable();
            $('#supplierListTable').DataTable();
            $('#poDetailsListTable').DataTable();
            $('.txtOtherLocation').hide();
            $('#deliveryDate').flatpickr({ dateFormat: "d-M-Y", minDate: "@DateTime.Now.ToString("dd/MMM/yyyy")" });

            $('#poDate').val("@DateTime.Now.ToString("dd-MMM-yyyy")");
            $('#deliveryDate').val("@DateTime.Now.ToString("dd-MMM-yyyy")");

            $('#summernote').summernote({
                tabsize: 2,
                height: 300
            });

            $("#currency").val(1);
            $('#currencyRate').hide();

            $("#currencyRate").keyup(function () {
                mrate = parseFloat($(this).val());
                if (isNaN(mrate) == true) {
                    mrate = 1;
                }
                var ConvUnitRate = parseFloat(bdtUnitRate) / mrate;
                $('#txtUnitRate').val(ConvUnitRate.toFixed(2));
                OrderQTYKey(parseFloat($("#txtOrderedQty").val()));
                VATKey(parseFloat($("#txtVat").val()));
            });

            $("#txtOrderedQty").keyup(function () {
                var thisOQVal = $(this).val();
                OrderQTYKey(thisOQVal);
            });

            $("#txtVat").keyup(function () {
                var thisVVal = $(this).val();
                VATKey(thisVVal);
            });

            $("#txtAit").keyup(function () {
                var thisAIT = $(this).val();
                AITKey(thisAIT);
            });


            $(".AitrelatedClass").hide();

            $("input:radio[name='includeAlt']").change(function () {
                if ($("input[name='includeAlt']:checked").val() == '1') {
                    $(".AitrelatedClass").hide();
                }
                else if ($("input[name='includeAlt']:checked").val() == '2') {
                    $(".AitrelatedClass").show();
                }
            });

            $(".numeric").keydown(function (e) {
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                    (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                    (e.keyCode >= 35 && e.keyCode <= 40)) {
                    return;
                }
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

        });
        function TotalAmt() {
            let sum = 0;
            $(".clsTotalAmount").each(function () {
                sum += +parseFloat($(this).val().replace(/,/g, '')) ? parseFloat($(this).val().replace(/,/g, '')) : 0;
            });
            $('#grandTotal').html(sum);
        }
        function refreshSupplierView() {
            $("#department").val("");
            $("#RFQRef").val("");
            $("#supplier").val("");
            $("#contactPerson").val("");
            $("#contactNo").val("");
        }

        function SupplierView(masterId, dept, rfq, requisitionId) {
            refreshSupplierView();
            $("#department").val(dept);
            $("#RFQRef").val(rfq);
            $("#txtCsmasterId").val(masterId);
            $("#txtRequsitionId").val(requisitionId);
            Common.Ajax('GET', '/global/api/GetCSDetailListByMasterId/' + masterId, [], 'json', GetCSDetailListByMasterId);

            Common.Ajax('GET', '/global/api/GetPurchaseOrderNo/' + requisitionId, [], 'json', GetPONumberByrequisitionId);
        }

        function GetPONumberByrequisitionId(response) {
            $("#poNo").val(response.autoNumber);
        }

        function GetCSDetailListByMasterId(response) {

            $("#Suppliertbl tbody>tr").empty();
            //console.log(response);

            $.each(response, function (key, value) {

                index = $("#Suppliertbl tbody>tr").length;
                var dtTable = $("#Suppliertbl");
                var tableBody = dtTable.find('tbody');
                var trHtml = '<tr>' +
                    '<td>' + value.orgCode + '</td>' +
                    '<td>' + value.organizationName + '</td>' +
                    '<td>' + value.total + '</td>' +

                    '<td><a href="javascript:void(0)" data-toggle="tooltip" title="Add" class="btn btn-info btn-xs" onclick="AddItem(' + value.supplierId + ',' + "'" + value.personName + "'" + ',' + "'" + value.contactNo + "'" + ',' + "'" + value.organizationName + "'" + ')"><i class="fa fa-info-circle"></i></a>&nbsp;&nbsp;' +

                    '</tr>';

                tableBody.append(trHtml);
            })
        }

        function AddItem(supplierId, personName, mobile, orgName) {
            $("#supplier").val(orgName);
            $("#contactPerson").val(personName);
            $("#contactNo").val(mobile);
            $("#txtSupplierId").val(supplierId);
            let cdId = parseInt($("#txtCsmasterId").val()) ? parseInt($("#txtCsmasterId").val()):0;
            //Common.Ajax('GET', '/global/api/GetCSDetailListBySupplierId/' + supplierId, [], 'json', GetCSDetailListBySupplierId);
            Common.Ajax('GET', '/global/api/GetCSDetailListByCSAndSupplierId/'+cdId+'/' + supplierId, [], 'json', GetCSDetailListBySupplierId);
        }

        function GetCSDetailListBySupplierId(response) {

            $("#poDetailsListTable tbody>tr").empty();
            $.each(response, function (key, value) {

                index = $("#poDetailsListTable tbody>tr").length;
                var dtTable = $("#poDetailsListTable");
                var tableBody = dtTable.find('tbody');
                var trHtml = '<tr>' +
                    '<td>' + value.itemCode + '</td>' +
                    '<td>' + value.itemName + '</td>' +
                    '<td>' + value.itemSpec + '</td>' +
                    '<td>' + value.unit + '</td>' +
                    '<td>' + value.qnt + '</td>' +
                    '<td>' + value.UnorderQnt + '</td>' +
                    '<td>' + value.CSUnitPrice + '</td>' +

                    '<td><a href="javascript:void(0)" data-toggle="tooltip" title="View" class="btn btn-info btn-xs" onclick="AddModal(' + value.csDetailsId + ',' + value.itemId + ',' + "'" + value.itemCode + "'" + ',`' + "'" + value.itemName.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'" + '`,`' + "'" + value.itemSpec.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'" + '`,' + "'" + value.unit + "'" + ',' + "'" + value.qnt + "'" + ',' + "'" + value.UnorderQnt + "'" + ',' + "'" + value.CSUnitPrice + "'" + ',' + "'" + value.PRQnt + "'" + ')"><i class="fa fa-info-circle"></i></a>&nbsp;&nbsp;' +

                    '</tr>';

                tableBody.append(trHtml);
            })
        }

        function AddModal(csDetailsId,itemId, itemCode, itemName, itemSpec, unit, qnt, UnorderQnt, CSUnitPrice, PRQnt) {
            $("#HiddenItemId").val(itemId);
            $("#HiddencsDetailsId").val(csDetailsId);
            $("#txtcode").val(itemCode);
            $("#txtname").val(itemName.slice(1, -1));
            $("#txtunit").val(unit);
            $("#txtSpec").val(itemSpec.slice(1, -1));
            $("#txtPRQty").val(PRQnt);
            $("#txtUnOrderedQty").val(UnorderQnt);
            $("#txtUnitRate").val(CSUnitPrice);
            bdtUnitRate = CSUnitPrice;
            $("#ValidatModal").modal("show");
        }

        function OrderQTYKey(thisOQVal) {
            if (isNaN(thisOQVal) == true || thisOQVal == "") {
                thisOQVal = 0;
            }
            var orderQty = parseFloat($("#txtOrderedQty").val());
            if (orderQty > parseFloat($("#txtUnOrderedQty").val())) {
                swal('Attention!', "Order quantity must be less then unorder quantity", 'warning')
                $("#txtOrderedQty").val('');
            }
            else {
                VATA = parseFloat($('#txtVatAmount').val());
                URate = $('#txtUnitRate').val();
                OQ = parseFloat(thisOQVal) * parseFloat(URate);
                $('#txtAmtExVat').val(OQ).number(true, 2);
                if (isNaN(VATA)) {
                    VATA = 0;
                }
                $('#txtTotalAmount').val(OQ + VATA).number(true, 2);
            }
        }
        function VATKey(thisVATVal) {
            if (isNaN(thisVATVal) == true || thisVATVal == "") {
                thisVATVal = 1;
            }
            var OrdQTY = parseFloat($('#txtOrderedQty').val());
            VATA = parseFloat(thisVATVal);
            URate = parseFloat($('#txtUnitRate').val());
            if (thisVATVal == 1) {
                OQ = 0;
            }
            else {
                OQ = (OrdQTY * URate * VATA) / 100;
            }
            $('#txtVatAmount').val(OQ).number(true, 2);
            $('#txtTotalAmount').val(OQ + (URate * OrdQTY)).number(true, 2);
        }
        function AITKey(thisAIT) {
            if (thisAIT == "") {
                thisAIT = 0;
            }
            var AITAMT = 0;
            var VATAMT = 0;
            var AITP = parseFloat(thisAIT);
            var OrdQTY = parseFloat($('#txtOrderedQty').val());
            var unitRate = parseFloat($('#txtUnitRate').val());
            var VATP = parseFloat($('#txtVat').val());
            if (isNaN(VATP)) {
                VATP = 0;
            }
            AITAMT = ((OrdQTY * unitRate) * AITP) / 100;
            $('#txtAitAmount').val(AITAMT).number(true, 2);
            $('#txtAitIncludeAmount').val(AITAMT + (OrdQTY * unitRate)).number(true, 2);
            VATAMT = ((AITAMT + (OrdQTY * unitRate)) * VATP) / 100;
            $('#txtLOAVatAmount').val(VATAMT).number(true, 2);
            $('#txtTotalAmount').val(VATAMT + AITAMT + (OrdQTY * unitRate)).number(true, 2);
        }

        function addCurrencyRate() {
            if ($('#currency').val() == 1) {
                $('#currencyRate').hide();
                $('#currencyRate').val('');
                $('#txtUnitRate').val(bdtUnitRate);
            }
            else {
                $('#currencyRate').show();
            }
        }


        function AddItemInfo() {

            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#poDetailsItemListTable tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#poDetailsItemListTable tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsId").val();
            }


            let id = parseInt($("#contactid").val()) ? parseInt($("#contactid").val()) : 0;

            let txtcode = $('#txtcode').val();
            let txtname = $('#txtname').val();
            let HiddencsDetailsId = $('#HiddencsDetailsId').val();
            let txtUnOrderedQty = $('#txtUnOrderedQty').val();
            let txtOrderedQty = $('#txtOrderedQty').val();
            let txtUnitRate = $('#txtUnitRate').val();
            let txtAmtExVat = $('#txtAmtExVat').val();
            let txtTotalAmount = $('#txtTotalAmount').val();
            let txtDescription = $('#txtDescription').val();
            let txtVat = $('#txtVat').val();
            let txtVatAmount = $('#txtVatAmount').val();
            let txtAit = $('#txtAit').val();
            let txtAitAmount = $('#txtAitAmount').val();
            let currency = $('#currency').val();
            let txtOtherLocation = $('#txtOtherLocation').val();

            let txtLocation = $('#txtLocation').val();
            if (txtLocation == null || txtLocation == '') {
                swal("Warning", "Please entry Location first", "warning");
                return
            }
            
            if (txtOrderedQty == null || txtOrderedQty == '') {
                swal("Warning", "Please entry order quantity first", "warning");
                return
            }

            if (txtOtherLocation == null || txtOtherLocation == '') {
                txtOtherLocation = "N/A";
            }

            if (txtAitAmount == null || txtAitAmount == '') {
                txtAitAmount = 0;
            }
            if (txtAit == null || txtAit == '') {
                txtAit = 0;
            }
            if (txtVatAmount == null || txtVatAmount == '') {
                txtVatAmount = 0;
            }
            if (txtAmtExVat == null || txtAmtExVat == '') {
                txtAmtExVat = 0;
            }
            if (txtVat == null || txtVat == '') {
                txtVat = 0;
            }

            if (txtDescription == null || txtDescription == '') {
                txtDescription = "N/A";
            }

            var editOption = parseInt($('#IsEditCon').val()) ? parseInt($('#IsEditCon').val()) : 0;
            var RowCount = $("#poDetailsItemListTable tbody>tr").length;

            for (i = 0; i < RowCount; i++) {

                var _itemId = $('#txtcode' + i + '').val();
                if (_itemId == txtcode && editOption == 0) {
                    swal("Warning", "You have already added this item!", "warning");
                    return false
                }
            }

            var dtTable = $("#poDetailsItemListTable");
            var tableBody = dtTable.find('tbody');
            var trHtml = '<tr id=' + index + '>' +
                '<td>' + txtcode + '<input type="hidden" name="txtcodeall"  id="txtcode' + index + '" value="' + txtcode + '"/></td>' +
                '<td>' + txtname + '<input type="hidden"name="csDetailsall" value="' + HiddencsDetailsId + '"/></td>' +
                '<td>' + txtUnOrderedQty + '<input type="hidden" name="txtVatall" value="' + txtVat + '"/></td>' +
                '<td>' + txtOrderedQty + '<input type="hidden"name="poQntall" value="' + txtOrderedQty + '"/></td>' +
                '<td>' + txtUnitRate + '<input type="hidden"name="txtUnitRateall" value="' + txtUnitRate + '"/></td>' +
                '<td>' + txtAmtExVat + '<input type="hidden"name="txtAmtExVatall" value="' + txtAmtExVat + '"/></td>' +
                '<td>' + txtTotalAmount + '<input type="hidden"name="txtVatAmountall" value="' + txtVatAmount + '"/><input type="hidden" name="txtDescriptionall" value="' + txtDescription + '"/><input type="hidden" name="txtAitall" value="' + txtAit + '"/><input type="hidden" name="txtAitAmountall" value="' + txtAitAmount + '"/><input type="hidden" name="currencyall" value="' + currency + '"/><input type="hidden" name="txtOtherLocationall" value="' + txtOtherLocation + '"/><input type="hidden" name="txtLocationall" value="' + txtLocation + '"/><input type="hidden" class="clsTotalAmount" value="' + txtTotalAmount + '"/></td>' +


                '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="DeleteContact(' + index + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
                //'<a onclick="EditconTbl(' + index + "', '" + phone + "','" + mobile + ", " + resouceid + ", " +id + ')" href="javascript:void(0)" title="Edit" class="btn btn-success btn-xs" > <i class="fa fa-edit"></i></a >' +

                '</tr>';

            if (ifExistIndex == null || ifExistIndex == "null") {
                tableBody.append(trHtml);
            }
            else {
                var rowUpdate = $("#poDetailsItemListTable tbody >tr:eq(" + ifExistIndex + ")");
                rowUpdate.replaceWith(trHtml);
                window.localStorage.setItem("holdIndex", null);
                ifExistIndex = null;
            }
            index = index + 1;
            $("#ValidatModal").modal("hide");
            TotalAmt();
        }

        function DeleteContact(index) {
            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                //window.location.href = "/Purchase/PurchaseOrder/DeleteComments?Id=" + Id + '&actionId=' + actionTypeId;;
                //$("#tblfuelDetails #" + index).remove();
                $("#poDetailsItemListTable #" + index).remove();

                swal('', 'Deleted Successfully!', 'success')
            });

            return false;
        }

        function OtherLocation() {
            if ($("#txtLocation").val() == 5) {
                $(".txtOtherLocation").show();
            } else {
                $(".txtOtherLocation").hide();
            }
        }



    </script>
}

